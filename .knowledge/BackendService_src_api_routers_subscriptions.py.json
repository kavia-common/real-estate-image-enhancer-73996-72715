{"is_source_file": true, "format": "Python", "description": "This is a Python source file defining API routes related to subscription management, including subscription status retrieval, checkout session creation, and handling Stripe webhooks for subscription events. It utilizes FastAPI, Stripe SDK, and project-specific utilities for database operations, security, auditing, and websocket notifications.", "external_files": ["../services/db", "../settings", "../utils/audit", "../utils/security", ".websocket"], "external_methods": ["db.get_subscription", "db.get_usage", "db.set_subscription", "settings.STRIPE_API_KEY", "settings.STRIPE_PRICE_BASIC", "settings.STRIPE_PRICE_PRO", "settings.SITE_URL", "send_notification", "get_current_user", "audit_event"], "published": [], "classes": [{"name": "SubscriptionStatus", "description": "Pydantic model representing the current subscription status and trial remaining information."}, {"name": "CheckoutSession", "description": "Pydantic model for returning the Stripe checkout session ID."}], "methods": [{"name": "get_subscription_status(user: dict = Depends(get_current_user))", "description": "API endpoint to get the current subscription status and trial information for the authenticated user.", "scope": "", "scopeKind": ""}, {"name": "create_checkout( plan: str, request: Request, user: dict = Depends(get_current_user) )", "description": "API endpoint to create a Stripe checkout session for subscribing to a specified plan.", "scope": "", "scopeKind": ""}, {"name": "stripe_webhook(request: Request)", "description": "Webhook handler to process Stripe events related to subscription creation and cancellation, updating database and notifying via websocket.", "scope": "", "scopeKind": ""}], "calls": ["stripe.checkout.Session.create", "stripe.Webhook.construct_event", "db.get_subscription", "db.get_usage", "db.set_subscription", "send_notification", "audit_event"], "search-terms": ["Stripe webhook", "subscription status", "checkout session", "Stripe API key", "websocket notification", "Stripe event handling", "subscription create webhook", "Stripe webhook secret"], "state": 2, "file_id": 15, "knowledge_revision": 41, "git_revision": "11ae1b4be0af5b44ad29d222d16c601843bcd284", "revision_history": [{"35": ""}, {"41": "11ae1b4be0af5b44ad29d222d16c601843bcd284"}], "ctags": [{"_type": "tag", "name": "CheckoutSession", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^class CheckoutSession(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "SubscriptionStatus", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^class SubscriptionStatus(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "create_checkout", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^async def create_checkout($/", "language": "Python", "kind": "function", "signature": "( plan: str, request: Request, user: dict = Depends(get_current_user) )"}, {"_type": "tag", "name": "get_subscription_status", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^async def get_subscription_status(user: dict = Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(user: dict = Depends(get_current_user))"}, {"_type": "tag", "name": "plan", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^    plan: Optional[str] = Field(None, description=\"Current subscription plan\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "SubscriptionStatus", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^router = APIRouter()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "session_id", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^    session_id: str = Field(..., description=\"Stripe checkout session ID\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "CheckoutSession", "scopeKind": "class"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^    status: str = Field(..., description=\"Subscription status\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "SubscriptionStatus", "scopeKind": "class"}, {"_type": "tag", "name": "stripe_webhook", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^async def stripe_webhook(request: Request):$/", "language": "Python", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "trial_remaining", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^    trial_remaining: Optional[int] = Field(None, description=\"Remaining trial edits\")$/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "SubscriptionStatus", "scopeKind": "class"}], "hash": "acbd81177e62ad84aef655d69a54260f", "format-version": 4, "code-base-name": "BackendService", "filename": "BackendService/src/api/routers/subscriptions.py", "fields": [{"name": "Optional[str] plan", "scope": "SubscriptionStatus", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str session_id", "scope": "CheckoutSession", "scopeKind": "class", "description": "unavailable"}, {"name": "str status", "scope": "SubscriptionStatus", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] trial_remaining", "scope": "SubscriptionStatus", "scopeKind": "class", "description": "unavailable"}]}