{"is_source_file": true, "format": "Python", "description": "This Python source file defines API routes for managing user subscriptions, including retrieving subscription status, creating checkout sessions with Stripe, and handling Stripe webhook events for subscription lifecycle updates. It utilizes FastAPI for HTTP routing, Stripe's SDK for payment processing, and includes utilities for auditing and real-time WebSocket notifications.", "external_files": ["../services/db", "../settings", "../utils/audit", "../utils/security", ".websocket"], "external_methods": ["db.get_subscription", "db.get_usage", "db.set_subscription", "settings.STRIPE_API_KEY", "settings.STRIPE_PRICE_BASIC", "settings.STRIPE_PRICE_PRO", "settings.SITE_URL", "send_notification", "audit_event", "get_current_user"], "published": ["/status", "/checkout/{plan}", "/webhook"], "classes": [{"name": "SubscriptionStatus", "description": "Pydantic model representing the subscription status and trial information of a user."}, {"name": "CheckoutSession", "description": "Pydantic model representing the Stripe checkout session ID response."}], "methods": [{"name": "get_subscription_status(user: dict = Depends(get_current_user))", "description": "Asynchronous endpoint that retrieves the current user's subscription status and remaining trial edits.", "scope": "", "scopeKind": ""}, {"name": "create_checkout( plan: str, request: Request, user: dict = Depends(get_current_user) )", "description": "Asynchronous endpoint that creates a Stripe checkout session for a specified plan ('basic' or 'pro') for the current user.", "scope": "", "scopeKind": ""}, {"name": "stripe_webhook(request: Request)", "description": "Asynchronous endpoint that handles Stripe webhook events related to subscription creation and cancellation, updating the database and sending real-time notifications.", "scope": "", "scopeKind": ""}], "calls": ["stripe.checkout.Session.create", "stripe.Webhook.construct_event", "db.get_subscription", "db.get_usage", "db.set_subscription", "send_notification", "audit_event"], "search-terms": ["Stripe subscription management", "FastAPI subscription routes", "Stripe webhook handler", "create checkout session", "subscription status API"], "state": 2, "file_id": 15, "knowledge_revision": 35, "git_revision": "", "ctags": [{"_type": "tag", "name": "CheckoutSession", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^class CheckoutSession(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "SubscriptionStatus", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^class SubscriptionStatus(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "create_checkout", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^async def create_checkout($/", "language": "Python", "kind": "function", "signature": "( plan: str, request: Request, user: dict = Depends(get_current_user) )"}, {"_type": "tag", "name": "get_subscription_status", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^async def get_subscription_status(user: dict = Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(user: dict = Depends(get_current_user))"}, {"_type": "tag", "name": "plan", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^    plan: Optional[str] = Field(None, description=\"Current subscription plan\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "SubscriptionStatus", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^router = APIRouter()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "session_id", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^    session_id: str = Field(..., description=\"Stripe checkout session ID\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "CheckoutSession", "scopeKind": "class"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^    status: str = Field(..., description=\"Subscription status\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "SubscriptionStatus", "scopeKind": "class"}, {"_type": "tag", "name": "stripe_webhook", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^async def stripe_webhook(request: Request):$/", "language": "Python", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "trial_remaining", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/subscriptions.py", "pattern": "/^    trial_remaining: Optional[int] = Field(None, description=\"Remaining trial edits\")$/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "SubscriptionStatus", "scopeKind": "class"}], "hash": "a67b4f110315d022ef4e818af1a36ab4", "format-version": 4, "code-base-name": "BackendService", "filename": "BackendService/src/api/routers/subscriptions.py", "fields": [{"name": "Optional[str] plan", "scope": "SubscriptionStatus", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str session_id", "scope": "CheckoutSession", "scopeKind": "class", "description": "unavailable"}, {"name": "str status", "scope": "SubscriptionStatus", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] trial_remaining", "scope": "SubscriptionStatus", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"35": ""}]}