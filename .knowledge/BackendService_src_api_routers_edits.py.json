{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints related to image editing in a FastAPI application. It includes data models for edit requests and responses, a background task for processing image edits via an external API, and routes for creating and listing edits. The code manages external API calls, database interactions, notifications, and audit logging.", "external_files": ["../services/db", "../settings", "../utils/audit", "../utils/security", "../utils/storage", "./websocket"], "external_methods": ["db.update_edit", "db.increment_usage", "db.get_subscription", "db.get_image", "db.create_edit", "db.list_edits_for_image", "audit_event", "send_notification", "get_current_user", "generate_result_path"], "published": ["create_edit", "list_edits"], "classes": [{"name": "EditRequest", "description": "Data model representing an edit request with a prompt."}, {"name": "EditResponse", "description": "Data model representing the response for an edit request, including status and paths."}], "methods": [{"name": "process_edit(user_id: str, edit_id: str, image_path: str, prompt: str)", "description": "Asynchronous background task to process an image edit, call external API, save result, update database, and send notifications.", "scope": "", "scopeKind": ""}, {"name": "create_edit( image_id: str, edit: EditRequest, background_tasks: BackgroundTasks, user: dict = Depends(get_current_user) )", "description": "FastAPI route handler to initiate an edit request, verify image ownership, create database record, and enqueue processing.", "scope": "", "scopeKind": ""}, {"name": "list_edits( image_id: str, user: dict = Depends(get_current_user) )", "description": "FastAPI route handler to list all edits associated with a given image.", "scope": "", "scopeKind": ""}], "calls": ["httpx.AsyncClient().post", "httpx.AsyncClient().get", "db.update_edit", "db.increment_usage", "db.get_subscription", "db.get_image", "db.create_edit", "db.list_edits_for_image", "send_notification", "audit_event", "generate_result_path", "get_current_user"], "search-terms": ["FastAPI image edit routes", "Google Nano Banana API", "edit request handling", "background task processing", "edit response model", "edit listing endpoint"], "state": 2, "file_id": 14, "knowledge_revision": 40, "git_revision": "11ae1b4be0af5b44ad29d222d16c601843bcd284", "revision_history": [{"33": ""}, {"40": "11ae1b4be0af5b44ad29d222d16c601843bcd284"}], "ctags": [{"_type": "tag", "name": "EditRequest", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^class EditRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "EditResponse", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^class EditResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "create_edit", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^async def create_edit($/", "language": "Python", "kind": "function", "signature": "( image_id: str, edit: EditRequest, background_tasks: BackgroundTasks, user: dict = Depends(get_current_user) )"}, {"_type": "tag", "name": "created_at", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    created_at: str = Field(..., description=\"Request timestamp\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "EditResponse", "scopeKind": "class"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    id: str = Field(..., description=\"Edit request ID\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "EditResponse", "scopeKind": "class"}, {"_type": "tag", "name": "image_id", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    image_id: str = Field(..., description=\"Source image ID\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "EditResponse", "scopeKind": "class"}, {"_type": "tag", "name": "list_edits", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^async def list_edits($/", "language": "Python", "kind": "function", "signature": "( image_id: str, user: dict = Depends(get_current_user) )"}, {"_type": "tag", "name": "process_edit", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^async def process_edit(user_id: str, edit_id: str, image_path: str, prompt: str):$/", "language": "Python", "kind": "function", "signature": "(user_id: str, edit_id: str, image_path: str, prompt: str)"}, {"_type": "tag", "name": "prompt", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    prompt: str = Field(..., description=\"Edit prompt\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "EditResponse", "scopeKind": "class"}, {"_type": "tag", "name": "prompt", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    prompt: str = Field(..., description=\"Natural language edit request\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "EditRequest", "scopeKind": "class"}, {"_type": "tag", "name": "result_path", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    result_path: Optional[str] = Field(None, description=\"Path to result image if complete\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "EditResponse", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^router = APIRouter()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    status: str = Field(..., description=\"Processing status\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "EditResponse", "scopeKind": "class"}, {"_type": "tag", "name": "updated_at", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    updated_at: str = Field(..., description=\"Last update timestamp\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "EditResponse", "scopeKind": "class"}], "hash": "0b388d8f61297480b1beec871fca4d4d", "format-version": 4, "code-base-name": "BackendService", "filename": "BackendService/src/api/routers/edits.py", "fields": [{"name": "str created_at", "scope": "EditResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str id", "scope": "EditResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str image_id", "scope": "EditResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str prompt", "scope": "EditResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] result_path", "scope": "EditResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str status", "scope": "EditResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str updated_at", "scope": "EditResponse", "scopeKind": "class", "description": "unavailable"}]}