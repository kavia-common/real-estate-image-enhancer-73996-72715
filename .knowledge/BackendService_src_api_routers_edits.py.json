{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints for handling image editing requests, including creating edit requests, processing them asynchronously, and listing existing edits. It includes data models, background task management for invoking external APIs, and user authorization checks.", "external_files": ["../services/db", "../settings", "../utils/audit", "../utils/security", "../utils/storage", ".websocket"], "external_methods": ["db.get_image", "db.create_edit", "db.update_edit", "db.list_edits_for_image", "db.increment_usage", "db.get_subscription", "audit_event", "send_notification", "generate_result_path", "get_current_user"], "published": ["create_edit", "list_edits"], "classes": [{"name": "EditRequest", "description": "Pydantic model representing an image edit request with a prompt."}, {"name": "EditResponse", "description": "Pydantic model representing the response data for an edit request, including status and result paths."}], "methods": [{"name": "process_edit(user_id: str, edit_id: str, image_path: str, prompt: str)", "description": "Asynchronous background function to process the image edit by calling external API, handling the response, saving results, and notifying the user.", "scope": "", "scopeKind": ""}, {"name": "create_edit( image_id: str, edit: EditRequest, background_tasks: BackgroundTasks, user: dict = Depends(get_current_user) )", "description": "API endpoint to initiate an image edit request, validates ownership, creates a database record, and queues background processing.", "scope": "", "scopeKind": ""}, {"name": "list_edits( image_id: str, user: dict = Depends(get_current_user) )", "description": "API endpoint to retrieve all edit requests for a specific image, ensuring user ownership.", "scope": "", "scopeKind": ""}], "calls": ["httpx.AsyncClient().post", "httpx.AsyncClient().get", "db.update_edit", "send_notification", "db.increment_usage", "db.get_subscription", "audit_event", "db.get_image", "db.create_edit", "db.list_edits_for_image"], "search-terms": ["edits.py", "image editing API", "background image processing", "Google Nano Banana API", "websocket notifications", "edit request", "edit response", "image id", "user authorization", "async background task"], "state": 2, "file_id": 14, "knowledge_revision": 33, "git_revision": "", "ctags": [{"_type": "tag", "name": "EditRequest", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^class EditRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "EditResponse", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^class EditResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "create_edit", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^async def create_edit($/", "language": "Python", "kind": "function", "signature": "( image_id: str, edit: EditRequest, background_tasks: BackgroundTasks, user: dict = Depends(get_current_user) )"}, {"_type": "tag", "name": "created_at", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    created_at: str = Field(..., description=\"Request timestamp\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "EditResponse", "scopeKind": "class"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    id: str = Field(..., description=\"Edit request ID\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "EditResponse", "scopeKind": "class"}, {"_type": "tag", "name": "image_id", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    image_id: str = Field(..., description=\"Source image ID\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "EditResponse", "scopeKind": "class"}, {"_type": "tag", "name": "list_edits", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^async def list_edits($/", "language": "Python", "kind": "function", "signature": "( image_id: str, user: dict = Depends(get_current_user) )"}, {"_type": "tag", "name": "process_edit", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^async def process_edit(user_id: str, edit_id: str, image_path: str, prompt: str):$/", "language": "Python", "kind": "function", "signature": "(user_id: str, edit_id: str, image_path: str, prompt: str)"}, {"_type": "tag", "name": "prompt", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    prompt: str = Field(..., description=\"Edit prompt\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "EditResponse", "scopeKind": "class"}, {"_type": "tag", "name": "prompt", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    prompt: str = Field(..., description=\"Natural language edit request\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "EditRequest", "scopeKind": "class"}, {"_type": "tag", "name": "result_path", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    result_path: Optional[str] = Field(None, description=\"Path to result image if complete\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "EditResponse", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^router = APIRouter()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    status: str = Field(..., description=\"Processing status\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "EditResponse", "scopeKind": "class"}, {"_type": "tag", "name": "updated_at", "path": "/home/kavia/workspace/code-generation/real-estate-image-enhancer-73996-72715/BackendService/src/api/routers/edits.py", "pattern": "/^    updated_at: str = Field(..., description=\"Last update timestamp\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "EditResponse", "scopeKind": "class"}], "hash": "1301bcac9c2e67a064f945f4dc05d976", "format-version": 4, "code-base-name": "BackendService", "filename": "BackendService/src/api/routers/edits.py", "fields": [{"name": "str created_at", "scope": "EditResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str id", "scope": "EditResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str image_id", "scope": "EditResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str prompt", "scope": "EditResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] result_path", "scope": "EditResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str status", "scope": "EditResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str updated_at", "scope": "EditResponse", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"33": ""}]}